---
import { Heading } from '@halyard/ui'
import Layout from '../../layouts/Layout.astro'
import { prisma } from '@portfolio/db'
import { getEntry, render } from 'astro:content'

export async function getStaticPaths() {
  const posts = await prisma.post.findMany()
  return posts.map((post) => ({ params: { slug: post.slug } }))
}

const { slug } = Astro.params

const post = await getEntry('blog', slug)

if (!post) {
  return Astro.redirect('/404')
}

// Format dates for display
const createdDate = new Date(post.data.createdAt)
const dateOptions = {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
} as const

const frontmatter = {
  title: post.data.title,
  description: post.data.description,
  created: {
    raw: post.data.createdAt.toISOString(),
    formatted: createdDate.toLocaleString('en-US', dateOptions),
  },
}

const { Content } = await render(post)
---

<Layout title={frontmatter.title} description={frontmatter.description}>
  <div class="mb-8">
    <Heading as="h1" className="heading-lg">
      {frontmatter.title}
    </Heading>
    <time class="text-subtlest" datetime={frontmatter.created.raw}>
      {frontmatter.created.formatted}
    </time>
  </div>
  <Content />
</Layout>
